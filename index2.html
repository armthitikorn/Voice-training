<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢ (Health Q&A)</title>
    <style>
        /* üé® CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö */
        body { font-family: 'Arial', sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .question-box { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 8px; background-color: #e9f7ff; }
        .response-area { margin-top: 10px; padding: 10px; background-color: #fff; border: 1px dashed #ccc; border-radius: 4px; }
        .controls button { padding: 10px 15px; margin: 5px 0; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        #record-start { background-color: #007bff; color: white; }
        #record-stop { background-color: #ffc107; color: #333; }
        #summary-button { background-color: #6c757d; color: white; }
        #register-button { background-color: #28a745; color: white; display: none; margin-left: 10px; }
        .log-entry { margin-top: 5px; padding: 5px; background-color: #e9ecef; border-radius: 4px; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="container">
        <h1>‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô üìû</h1>
        
        <details open>
            <summary>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Log)</summary>
            <div id="status-log"></div>
        </details>
        
        <hr>

        <div class="question-box">
            <h2 id="question-header">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1</h2>
            <p id="current-question">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>

            <div class="controls">
                <button id="record-start">üéôÔ∏è ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)</button>
                <button id="record-stop" disabled>‚èπÔ∏è ‡∏Å‡∏î‡∏´‡∏¢‡∏∏‡∏î</button>
            </div>
            
            <div class="response-area">
                **‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ö:** <span id="customer-response">...‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏ñ‡∏≤‡∏°...</span>
                <audio id="customer-audio" src="" hidden controls></audio>
            </div>
        </div>

        <button id="summary-button" disabled>‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á</button>
        <button id="register-button" disabled>üìù ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
    </div>

    <script>
        // --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ---
        let currentStep = 1;
        const totalSteps = 5; // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å 5 ‡∏Ç‡πâ‡∏≠
        let isRecording = false;

        // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û 5 ‡∏Ç‡πâ‡∏≠
        const questions = [
            "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
            "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
            "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ö ‡πÑ‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
            "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?", // Q4: ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö '‡πÄ‡∏Ñ‡∏¢'
            "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏á‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"
        ];

        // ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÉ‡∏ä‡πâ URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤)
        const customerResponses = {
            // ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° Q1, Q2, Q3, Q5
            '‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢': 'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q4/health5_P1_P1Q4_1762340917924.webm',
            
            // ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á" ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö '‡πÄ‡∏Ñ‡∏¢' ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Q4
            '‡πÄ‡∏Ñ‡∏¢': 'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q7/health5_P1_P1Q7_1762341034892.webm', 

            // ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏£‡∏Ñ‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á': 'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q7/health5_P1_P1Q7_1762341034892.webm',
            '‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô': 'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q6/health5_P1_P1Q6_1762340992884.webm',
            '‡∏´‡∏±‡∏ß‡πÉ‡∏à': '‡∏´‡∏±‡∏ß‡πÉ‡∏à.webm', // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ, ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°
            '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á': '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á.webm' // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ, ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°
        };

        // ‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 4 (4 ‡πÇ‡∏£‡∏Ñ)
        const hiddenDiseases = [
            { name: "‡πÇ‡∏£‡∏Ñ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô", key: "‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô" },
            { name: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á", key: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á" }, 
            { name: "‡∏´‡∏±‡∏ß‡πÉ‡∏à", key: "‡∏´‡∏±‡∏ß‡πÉ‡∏à" },
            { name: "‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á", key: "‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á" }
        ];

        // ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡πà‡∏≠‡∏¢ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á" ‡∏ó‡∏µ‡πà‡∏°‡∏µ 4 ‡πÑ‡∏ü‡∏•‡πå)
        const pressureSubAnswers = [
            'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q9/health5_P1_P1Q9_1762341172636.webm', // ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô 1
            'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q8/health5_P1_P1Q8_1762341131100.webm', // ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô 2
            'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q10/health5_P1_P1Q10_1762341190452.webm', // ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô 3
            'https://wzwyotzzxycqfwercakh.supabase.co/storage/v1/object/public/responses/part1/P1Q11/health5_P1_P1Q11_1762341222396.webm'  // ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô 4
        ];
        
        // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á 4 ‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        let selectedDisease;


        // --- DOM Elements ---
        const qHeader = document.getElementById('question-header');
        const qText = document.getElementById('current-question');
        const recordStartBtn = document.getElementById('record-start');
        const recordStopBtn = document.getElementById('record-stop');
        const customerResponseSpan = document.getElementById('customer-response');
        const customerAudio = document.getElementById('customer-audio');
        const summaryBtn = document.getElementById('summary-button');
        const registerBtn = document.getElementById('register-button');
        const logArea = document.getElementById('status-log');


        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ---

        /** ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å) */
        function updateUI(step) {
            if (step > totalSteps) { 
                qHeader.textContent = "‚úÖ ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û";
                qText.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠";
                recordStartBtn.disabled = true;
                recordStopBtn.disabled = true;
                summaryBtn.disabled = false;
                customerResponseSpan.textContent = "---";
                customerAudio.removeAttribute('src');
                return;
            }
            
            qHeader.textContent = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${step}`;
            qText.textContent = questions[step - 1];
            
            customerResponseSpan.textContent = "...‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏ñ‡∏≤‡∏°...";
            customerAudio.removeAttribute('src');
            recordStartBtn.disabled = false;
            recordStopBtn.disabled = true;
            registerBtn.style.display = 'none';
            registerBtn.disabled = true;
        }

        /** ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡∏á‡πÉ‡∏ô Log */
        function logAction(actor, action) {
            const time = new Date().toLocaleTimeString('th-TH');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `[${time}] ‚û°Ô∏è **${actor}:** ${action}`;
            logArea.prepend(logEntry);
        }

        /** ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå */
        function getCustomerAnswer(step) {
            if (step === 4) {
                // Q4: ‡∏ï‡∏≠‡∏ö '‡πÄ‡∏Ñ‡∏¢'
                return {
                    text: `‡πÄ‡∏Ñ‡∏¢, (‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Ñ‡∏∑‡∏≠ ${selectedDisease.name})`, 
                    audio: customerResponses['‡πÄ‡∏Ñ‡∏¢'] 
                };
            } else {
                // Q1, Q2, Q3, Q5: ‡∏ï‡∏≠‡∏ö '‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢'
                return {
                    text: "‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢",
                    audio: customerResponses['‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢']
                };
            }
        }

        /** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏ñ‡∏≤‡∏°‡πÇ‡∏£‡∏Ñ‡∏¢‡πà‡∏≠‡∏¢ 4 ‡πÇ‡∏£‡∏Ñ (‡∏´‡∏•‡∏±‡∏á Q4) */
        function askHiddenDisease(subStep) {
            // subStep ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 1 ‡∏ñ‡∏∂‡∏á 4 (4 ‡πÇ‡∏£‡∏Ñ‡∏¢‡πà‡∏≠‡∏¢)
            if (subStep > hiddenDiseases.length) {
                currentStep = 5; // ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ Q5
                updateUI(currentStep);
                return;
            }
            
            const disease = hiddenDiseases[subStep - 1];
            const isSelected = (disease.key === selectedDisease.key);
            
            let answerText = "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö";
            let answerAudio = customerResponses['‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢'];

            // ‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏∏‡πà‡∏° (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á)
            if (isSelected) {
                answerAudio = pressureSubAnswers[subStep - 1]; // ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå 1-4 ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
                answerText = `‡πÉ‡∏ä‡πà, ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ${disease.name} (‡∏ï‡∏≠‡∏ö‡∏¢‡πà‡∏≠‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${subStep}/4)`;
            } 
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö '‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢' ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∏‡∏î 4 ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏≤‡∏° '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á'

            qHeader.textContent = `‡∏ã‡∏±‡∏Å‡∏ñ‡∏≤‡∏°‡πÇ‡∏£‡∏Ñ‡∏¢‡πà‡∏≠‡∏¢ (‡∏´‡∏•‡∏±‡∏á Q4) ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${subStep}`;
            qText.textContent = `‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ${disease.name} ‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
            
            customerResponseSpan.textContent = answerText;
            customerAudio.src = answerAudio;
            customerAudio.play();
            logAction('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', `‡∏ï‡∏≠‡∏ö: ${answerText} (URL: ${answerAudio.substring(0, 70)}...)`);
            
            currentStep++; // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏õ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡πà‡∏≠‡∏¢‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        }


        // --- Event Listeners ---

        recordStartBtn.addEventListener('click', () => {
            if (qHeader.textContent.includes("‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î")) return;
            
            isRecording = true;
            recordStartBtn.disabled = true;
            recordStopBtn.disabled = false;
            logAction('‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á`);
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏£‡∏¥‡∏á: MediaRecorder.start()
        });

        recordStopBtn.addEventListener('click', () => {
            if (!isRecording) return;
            
            isRecording = false;
            recordStartBtn.disabled = false;
            recordStopBtn.disabled = true;
            logAction('‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', `‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á`);
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏£‡∏¥‡∏á: MediaRecorder.stop()

            // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•)
            setTimeout(() => {
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏ñ‡∏≤‡∏°‡πÇ‡∏£‡∏Ñ‡∏¢‡πà‡∏≠‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (currentStep > totalSteps && currentStep <= totalSteps + hiddenDiseases.length) {
                    const subStep = currentStep - totalSteps;
                    askHiddenDisease(subStep);
                    return; 
                }

                // ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å
                let answer = getCustomerAnswer(currentStep);

                customerResponseSpan.textContent = answer.text;
                customerAudio.src = answer.audio;
                customerAudio.play();
                logAction('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', `‡∏ï‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥: ${answer.text} (URL: ${answer.audio.substring(0, 70)}...)`);

                // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                if (currentStep === 4) {
                    // ‡∏´‡∏•‡∏±‡∏á Q4 ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏ñ‡∏≤‡∏°‡πÇ‡∏£‡∏Ñ‡∏¢‡πà‡∏≠‡∏¢
                    currentStep = totalSteps + 1; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÇ‡∏£‡∏Ñ‡∏¢‡πà‡∏≠‡∏¢‡∏Ç‡πâ‡∏≠ 1
                    askHiddenDisease(1); 
                } else {
                    currentStep++;
                    updateUI(currentStep);
                }

            }, 1000); 
        });

        summaryBtn.addEventListener('click', () => {
            logAction('‡∏£‡∏∞‡∏ö‡∏ö', '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏î "‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á"');
            summaryBtn.disabled = true;
            registerBtn.style.display = 'inline-block';
            registerBtn.disabled = false;
        });

        registerBtn.addEventListener('click', () => {
            logAction('‡∏£‡∏∞‡∏ö‡∏ö', '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏î "‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£"');
            alert("‡∏à‡∏≥‡∏•‡∏≠‡∏á: ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á");
        });


        // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ---
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á 4 ‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        selectedDisease = hiddenDiseases.find(d => d.key === '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á');
        logAction('‡∏£‡∏∞‡∏ö‡∏ö', `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å: ‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏∏‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô Q4 ‡∏Ñ‡∏∑‡∏≠ **${selectedDisease.name}** ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏ï‡∏≠‡∏ö 4 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á`);
        updateUI(currentStep);
    </script>
</body>
</html>
